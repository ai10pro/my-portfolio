<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React入門1|Article</title>
    <meta name="description" content="Reactのチュートリアルを実践">
    <link rel="stylesheet" href="../../style.css">
    <link
        rel="stylesheet"
        href="https://unpkg.com/modern-css-reset/dist/reset.min.css"
    />
    <!-- prism -->
    <!-- https://prismjs.com/download.html#themes=prism-tomorrow&languages=markup+css+clike+javascript+jsx&plugins=line-numbers+show-language+unescaped-markup+toolbar+copy-to-clipboard -->
    <link rel="stylesheet" href="../../style/prism.css">
    <script src="../../script/prism.js"></script>
</head>
<body>
    <header >
        <div class="header_inner">
            <a href="../../index.html">
                <h1 class="title-logo">とりさん</h1>
            </a>
            <nav class="gnav">
                <ul class="gnav-list">
                    <li><a href="../works.html">Works</a></li>
                    <li><a href="../skills.html">Skills</a></li>
                    <li><a href="https://x.com/ai10pro">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main id="article-main">
        
        <div class="article-head">
            <h1>React入門1</h1>
            <p class="day">公開日：2024/07/28(sun)</p>
            <p class="tag">React公式チュートリアルを実践！フロントエンドではお馴染みになりつつあるReactを勉強します！今回はチュートリアルのゲームが一旦完成する部分まで作成します！</p>
        </div>

        <div class="large-section">
            <h2>1. Reactについて</h2>
            <h3>1.1 Reactとは？</h3>
            <p>ReactとはJavaScriptのオープンソースフレームワーク・ライブラリの1つ。Meta社（旧Facebook）が2011年に社内用で開発していたライブラリを2013年に一般公開されたもの。<br>
            <a href="https://ja.react.dev/">React 公式サイト</a><br>
            <a href="https://ja.legacy.reactjs.org/">旧React 公式サイト</a><br>
            現在では日本でもフロントエンド開発の主流となっている。
            </p>
            <h3>1.2 Reactの特徴</h3>
            <h4>コンポーネント化によるUI作成</h4>
            <p>Reactの一番の特徴はUIをコンポーネントを利用して開発を行う点である。Webサイトにおける1部分をリンクボタン、説明文、動画など同じ内容を繰り返し使うものをコンポーネント化し、それらを組み合わせて作り上げていく。これにより、コードの再利用性が高まり、保守性が向上する。<br>
            <h4>マークアップとコードからコンポーネントを作成</h4>
            <p>JSXと呼ばれるマークアップ構文を用いて開発を行う。JSXはHTMLと同様にコードを書くことができるため追加の技術取得をあまり必要としない。また、ReactコンポーネントはあくまでJavaScriptの関数と定義するためIf文などを用いて、条件分岐の表示の対応がしやすい。</p>
            <h4>仮想DOM</h4>
            <p>Reactは仮想DOM（Virtual Document Object Model）を用いて、実際のDOMとの差分を計算し、最小限の更新を行うことができる。これにより、パフォーマンスの向上が期待できる。</p>
            <h4>フレームワークの利用</h4>
            <p>Reactはあくまでライブラリであり、コンポーネントの組み合わせが可能であるが、外部からのデータ取得などの指定がなあい。その場合Next.jsなどフルスタックのフレームワークを使うことであらゆるUIを作成できる。</p>
            <h4>あらゆるプラットフォーに対応</h4>
            <p>ReactはJavaScriptコードを段階的にロードすることにより、ウェブアプリの素早い読み込みを実現している。そのため、多くのウェブブラウザでの動作が保証されている。<br>
                また、同Meta社が開発したReactNativeの利用により、クラスプラットフォームアプリ開発、すなわち、iOSアプリ、Androidアプリの作成が可能である。</p>
            </p>
        </div>
        <div class="large-section">
            <h2>2. Reactの基本</h2>
            <h3>2.1 Reactチュートリアルについて</h3>
            <p>公式サイトのドキュメントとして公開されている三目並べを作成する。また、ここではHTMLとJavaScriptについて多少慣れていることを前提として作られているため随時JavaScriptドキュメントなどの活用が考えられる。<br>
            <a href="https://ja.react.dev/learn/tutorial-tic-tac-toe">React公式 チュートリアル:三目並べ</a><br>
            <a href="https://ja.legacy.reactjs.org/tutorial/tutorial.html">旧React公式 チュートリアル:三目並べ</a><br>
            以上サイトを参照し、Reactの基本を学ぶ。旧サイトは現在更新されていないが、一部説明などが詳しいため参照している。</p>
            
            <h3>2.2 Reactの環境構築</h3>
            <p>Reactは本来ローカル環境を構築し、開発を行う。その手順を簡易的に示すが、今回はウェブブラウザ上でコード記述を行い実行を確認する。<br>
            <a href="https://ja.legacy.reactjs.org/tutorial/tutorial.html#setup-option-2-local-development-environment">環境構築手順（旧公式サイト）</a><br>
            1. Node.jsのインストール<br>
            2. 以下コマンドの実行により新規プロジェクトを作成 <br>*my-app*はプロジェクト名が入る。<br>
            </p>
            <div class="code_container">
                <pre class="prism code-content">
<code class="language-cmd" data-lang="cmd">npx create-react-app *my-app*</code></pre>
            </div>
            <p>3. 以下コマンドによりプロジェクトを起動</p>
            <div class="code_container">
                <pre class="prism code-content">
<code class="language-cmd" data-lang="cmd">cd *my-app*<br>npm start</code></pre>
            </div>
            <p>4. ブラウザでlocalhost:3000にアクセスし、Reactの初期画面が表示されれば成功</p>

            <h3>2.3 チュートリアルの環境構築</h3>
            <p>チュートリアルではCodeSandBoxというサイトを利用してコーディングを行う。<br>
            <a href="https://codesandbox.io/s/new">CodeSandBox</a><br>
            </p>
        </div>

        <div class="large-section">
            <h2>3. チュートリアル：三目並べ</h2>
            <p>今回は内容の関係でゲームが一旦完成し、終了宣言をかける部分までとなる。</p>
            <p>
                <a href="https://codesandbox.io/s/q2z497?file=%2Fsrc%2FApp.js&utm_medium=sandpack">チュートリアルで公開されている完成形</a>
            </p>
            <h3>3.1 チュートリアルのセットアップ</h3>
            <p>以下のサイトにアクセスし、セットアップ済みのコードに追加でコーディングを行う<br>
            <a href="https://codesandbox.io/s/j67kkz?file=%2Fsrc%2FApp.js&utm_medium=sandpack">セットアップ済みのプロジェクト</a>
            <br>
            このサイトではすでにプロジェクトが作成されており、Browserに表示されるのはDevelopされたものとなる。<br>
            CodeSandboxの画面は次のようになっている。<br>
            <img src="../../images/articles/01_react/001.png" alt="CodeSandboxのスクリーンショット"><br>
            画面左にあるのは<span class="bg-yellow">ファイルセクション</span>であり、App.jsやstyle.cssなどファイルが表示されている。ここには各種ファイルを追加する際に表示される。画面中央は<span class="bg-yellow">コードエディタ</span>であり、開いているコードを確認・編集が可能。画面右側は<span class="bg-yellow">Browserセクション</span>であり、コードを実行した際の表示がされる。<br>
            </p>

            <h3>3.2 スタートアップコードの確認</h3>
                <h4>App.js</h4>
                <div class="code_container">
                    <pre class="prism line-numbers language-js code-content">
<code class="language-js" data-lang="js">export default function Square() {
    return &ltbutton className="square"&gtX&lt/button&gt;
}
</code></pre></div>

                <p>1行目は<span class="bg-code">Square関数</span>の定義を行っている。<span class="bg-code">export</span>というJavaScriptのキーワードはこの関数を外部からアクセスできるようにするもの。<span class="bg-code">default</span>というキーワードは他ファイルから参照の際この関数がこのファイルのメイン関数であることを示している。</p>
                <h4>style.css</h4>
                <p>すでに習得済みとして説明を省略する。ただし、Reactではclassで定義されたものには割り当てられない。<span class="bg-yellow">className</span>で定義されているものに対してstyle.cssが割り当てたられる。</p>
                <h4>index.js</h4>
                <div class="code_container">
                    <pre class="prism line-numbers language-js code-content">
<code class="language-js" data-lang="js">import { StrictMode } from 'react';
import { createRoot } from 'react-dom/client';
import './styles.css';

import App from './App';
</code></pre></div>
                <p>今回のチュートリアルにてこのファイルは編集しない。しかし、今ファイルはApp.jsなどコンポーネントと、ウェブブラウザの橋渡しをする最も重要なファイルである。
                    <br>このファイルにて以下の4つの部品の取り出しをおこなっている。
                    <ul>
                        <li>React</li>
                        <li>WebブラウザとReactのやりとりを行うReact DOM</li>
                        <li>コンポーネント用のスタイル（style.css）</li>
                        <li>App.jsにて作成したコンポーネント</li>
                    </ul>
                    <p>これらの部品を呼び出し、まとめ、Public内のindex.htmlに入れることにより、JavaScriptでの記述をWebブラウザで表示できる。
                </p></p>
            
            <h3>3.3 三目並べの盤面の作成</h3>
            <h4>2マス目を作る</h4>
            <p>三目並は盤面が9マス必要ですが、1マスしかありません。単純にbuttonタグをコピーペーストし実行しようとすると次のようなTypeエラーが出ます。
                <br><p class="bg-code">Cannot assign to read only property 'message' of object 'SyntaxError: /src/App.js: Adjacent JSX elements must be wrapped in an enclosing tag. Did you want a JSX fragment &lt&gt...&lt/&gt? (3:2)</p>
                <p>これはReactコンポーネントの性質あり、コンポーネが返す（Return）の値は1つにまとめられたものである必要があるためである。buttonのJSX要素を複数返したい場合はフラグメントと呼ばれる「<span class="bg-code">&lt&gt</span>」、「<span class="bg-code">&lt/&gt</span>」で囲うことによりこの複数の要素の値を返すことができる。
                <br>修正したプログラムと実行結果は次のとおりになる。</p>
                <div class="code_container">
                    <pre class="prism line-numbers language-js code-content">
<code class="language-js" data-lang="js">export default function Square() {
    return (
        &lt&gt
            &ltbutton className="square"&gtX&lt/button&gt
            &ltbutton className="square"&gtX&lt/button&gt
        &lt/&gt
    );
}
</code></pre></div>
                <p>
                    <img src="../../images/articles/01_react/002.png" alt="2マス目の表示のための修正後">
                </p>
            </p>
            <h4>2マス目以降の作成</h4>
            <p>前のようにコピーペーストを続ければ9マスを作ることができるのですが、しかしこのままであると9マス分のコードが必要となりますし、buttonの子要素にはXが入っていますが○になる場合もありその度にどこの行の処理が必要か考えるのは大変である。そこでReactの強みであるコンポーネントを作成することで再利用可能で可読性の高いものにする。</p>
            <p>初めに関数名を次のように変え、今から作るものがSquareを組み合わせてできたBoardを作るものとして関数名を変える。</p>
            <div class="code_container">
                <pre class="prism line-numbers language-js code-content">
<code class="language-js" data-lang="js">export default function Board() {
    //......
}
</code></pre></div>
            <p>次にSquare関数を先ほどのButtonで作成しそれを、Board関数内で呼び出す。ここで<span class="bg-code">board-row</span>というクラスを与えているが、このクラスにはボタンを折り返して表示させるた目の親要素のStyleが割り当てられている。</p>
            <div class="code_container">
                <pre class="prism line-numbers language-js code-content">
<code class="language-js" data-lang="js">function Square() {
    return &ltbutton className="square"&gt1&lt/button&gt;
}

export default function Board() {
    return (
        &lt&gt
            &ltdiv className="board-row"&gt
                &ltSquare /&gt
                &ltSquare /&gt
                &ltSquare /&gt
            &lt/div&gt
            &ltdiv className="board-row"&gt
                &ltSquare /&gt
                &ltSquare /&gt
                &ltSquare /&gt
            &lt/div&gt
            &ltdiv className="board-row"&gt
                &ltSquare /&gt
                &ltSquare /&gt
                &ltSquare /&gt
            &lt/div&gt
        &lt/&gt
    );
}
</code></pre></div>
            <p><span class="bg-code">Square</span>関数の定義時、先頭に<span class="bg-code">export default</span>を入れてはいけない。入れてしまうことにより前述したとおり、App.jsを読み込んだ際、メイン関数であると認識されてしまうためである。</p>
            <p><span class="bg-code">Board</span>関数内にて別コンポーネントの呼び出しはコードのようになる。ここでは関数名（コンポーネント名）の先頭は大文字になるという点に注意が必要である。また、ファイルをまたいでの呼び出し時には次のように先頭にて該当ファイルの読み込みを行う必要がある。</p>
            <div class="code_container">
                <pre class="prism line-numbers language-js code-content">
<code class="language-js" data-lang="js">import Square from './Square';
</code></pre></div>
            <img src="../../images/articles/01_react/003.png" alt="">
            <p>このままでは全てのマスが1で固定されてしまうため、Squareコンポーネントの呼び出しの際に値を指定したい。そのためSquare関数にプロパティを入力できるようにする。この方法はHTMLにJavaScriptやFlaskを用いたPython WebAPPの開発時と同じ方法である。</p>
            <div class="code_container">
                <pre class="prism line-numbers language-js code-content">
<code class="language-js" data-lang="js">function Square({value}) {
    return &ltbutton className="square"&gt{value}&lt/button&gt;
}
export default function Board() {
    return (
        &lt&gt
            &lt div className="board-row" &gt
                &lt Square value="1" /&gt
                &lt Square value="2" /&gt
                &lt Square value="3" /&gt
            &lt /div&gt
            /....
        &lt /&gt
    );
}
</code></pre></div>
            <img src="../../images/articles/01_react/004.png" alt="">
            <p>このようにpropsを引数に取り、その中のvalueを表示することで、Board関数内でSquare関数を呼び出す際に値を指定することができる。</p>

            <h3>3.3 盤面での処理の追加</h3>
            <h4>インタラクティブなコンポーネントの設計</h4>
            <p>簡単な処理として各ボタンを押すたびにそれがXに変わる動作を設計する。<span class="bg-code">Square</span>関数の中に<span class="bg-code">handleClick</span>関数を定義し、呼び出しのpropsに<span class="bg-code">onClick</span>を追加する。</p>
            <div class="code_container">
                <pre class="prism line-numbers language-js code-content">
<code class="language-js" data-lang="js">function Square({value}) {
    function handleClick() {
        console.log('clicked!');
    }
    return 
        &ltbutton className="square" onClick={onClick}&gt
        {value}
        &lt/button&gt;
}
</code></pre></div>
            <p>このプログラムでの動作を確認する。Consoleを開いた状態でかく番号を押すたびに<span class="bg-code">clicked!</span>というように出力されていれば問題ない。<br>
            ここでわかるように各このポーネンとの中で関数を新たに定義することができその関数を利用した動作を出力させることができる。</p>
            <img src="../../images/articles/01_react/005.png" alt="">
            <p>ここで、<span class="bg-code">handleClick</span>関数をSquare関数の外で定義したプログラムを試す。</p>
            <div class="code_container">
                <pre class="prism line-numbers language-js code-content">
<code class="language-js" data-lang="js">function Square({value}) {
    return
        &ltbutton className="square" onClick={handleClick}&gt
        {value}
        &lt/button&gt;
}
function handleClick() {
    console.log('clicked!');
}
</code></pre></div>
            <p>実際に動作を確認してみたところ先ほどと同様の処理が行われていることがわかった。このようにコンポーネント外での関数定義にも対応していることがわかった。しかしコードの可読性や、使い回し、保守を考えた時必要なコンポーネントを必要な場所で記載したほうが良いのではないかと個人的には考えた。
            </p>
            
            <p>次にSquareコンポーネントにてクリックされたことを記憶し、"X"を表示する機能を実装する。「記憶」するためにはReactコンポーネントの<span class="bg-yellow">state</span>というものを利用する。
            <br>ReactはuseStateと関数の提供があり、これを利用することでコンポーネント内で状態を保持することができる。useStateは配列を返し、その中に状態の初期値を入れることができる。また、useStateは2つの要素を返す。1つ目は状態の値、2つ目は状態を更新するための関数である。</p>
            <p>ファイルの先頭にて<span class="bg-code">useState</span>をインポートし<span class="bg-code">Square</span>関数からvalueのpropsプロパティを削除する。その代わりに2つの要素の配列にて<span class="bg-code">useState</span>を呼び出す。</p>
            <div class="code_container">
                <pre class="prism line-numbers language-js code-content">
<code class="language-js" data-lang="js">import { useState } from 'react';

function Square() {
    const [value, setValue] = useState(null);

    function handleClick() {
    //...
}}
</code></pre></div>
            <p><span class="bg-code">value</span>がstateの現在の値を格納し、<span class="bg-code">setValue</span>はその値の更新に使う関数ということになる。<span class="bg-code">useState</span>にわたすNullはstate変数の初期値として使用するため今回の場合<span class="bg-code">value</span>は<span class="bg-code">null</span>という値から処理が行われる</p>
            <p>次に<span class="bg-code">handleClick</span>関数内で<span class="bg-code">setValue</span>を使い、クリックされた際にvalueの値を変更する。ここでは"X"を表示するようにする。
            <br>値の変更には先ほど定義している<span class="bg-code">setValue</span>関数を使用し以下のような記述を行う。</p>
            <p>また、コンポーネント自体がpropsの受け取りを行わないため、Boardコンポーネントので呼び出されるSquareコンポーネントのpropsを削除する。</p>
        
            <div class="code_container">
                <pre class="prism line-numbers language-js code-content">
<code class="language-js" data-lang="js">import { useState } from 'react';
function Square() {
    const [value, setValue] = useState(null);

    function handleClick() {
        setValue('X');
    }
    return(
        &ltbutton className="square" onClick={handleClick}&gt
        {value}
        &lt/button&gt;
    );
}

export default function Board() {
    return (
        &lt&gt
            &lt div className="board-row" &gt
                &lt Square /&gt
                &lt Square /&gt
                &lt Square /&gt
            &lt/div&gt
            /....
        &lt/&gt
    );
}
</code></pre></div>
            <img src="../../images/articles/01_react/006.png" alt="">
            <p>このようにクリックされた際に"X"が表示されるようになった。このようにReactではコンポーネントの再利用性が高く、コードの可読性が高いため、保守性が高いコードを書くことができる。</p>

            <h3>3.4 ゲームの状態を管理する</h3>
            <p>ゲームのデータ保持にはいくつか方法がある。ここで考えなければいけないのは"○"と"X"の処理があるという点だ。それぞれどこの盤面でどちらが入力されているかを先ほどのように<span class="bg-code">Square</span>コンポーネント内で保持する方法が最初に考えられる。しかしこの方法は今後ゲームの終了処理を行う際複数の値をSquareコンポーネントに移動し確認する処理が必要となり現実的ではない。よってこの方法は使わないこととする。</p>
            <p>別の方法として<span class="bg-code">Board</span>コンポーネントにてどのマスがどの状態であるかを一括で管理（配列を使った管理）にすることで終了処理の実装も比較的容易に実装可能である。よってこの方法を採用する。</p>
            <p>まずはBoardコンポーネントにてstateを定義し、その中に9つのマスの状態を保持する配列を定義する。<span class="bg-code">squares</span>という名前のstate変数を宣言し、デフォルト値は<span class="bg-code">null</span>を返す。</p>
            <div class="code_container">
                <pre class="prism line-numbers language-js code-content">
<code class="language-js" data-lang="js">//...
export default function Board() {
    const [squares, setSquares] = useState(Array(9).fill(null));
    return (
        //...
    );
}
</code></pre></div>
            <p>この変更により、Squareコンポーネントにpropsにて値を渡し、それを出力するように変更する。</p>
            <div class="code_container">
                <pre class="prism line-numbers language-js code-content">
<code class="language-js" data-lang="js">import { useState } from 'react';
function Square({value}) {
    return (
        &ltbutton className="square"&gt{value}&lt/button&gt;
    );
}
export default function Board() {
    const [squares, setSquares] = useState(Array(9).fill(null));
    return (
        &lt&gt
            &ltdiv className="board-row" &gt
                &lt Square value={squares[0]}/&gt
                &lt Square value={squares[1]}/&gt
                &lt Square value={squares[2]}/&gt
            &lt/div&gt
            /....

        &lt/&gt
    );
}
</code></pre></div>
            <p>このようにSquareコンポーネントにてpropsにて値を渡し、それを出力するように変更する。
                <p class="bg-yellow">このように複数の子コンポーネントからデータを収集したり2つの子コンポーネント同士での通信を行う場合親コンポーネントに共有のstateを宣言する。子コンポーネントにはpropsにてデータのやり取りができ、この方法によりコンポーネントの同期を行うことができる。</p>
                <p>ここでは値の変更処理をおこなっていないため初めに何も表示されず、ボタンを押しても何も表示されない。</p>
            </p>
            <h4>クリックされた際の処理</h4>
            <p>初めにクリックされた時、Xを表示するようにする。
                ここで、どのマス目が埋まっているかを管理しているのは<span class="bg-code">Board</span>コンポーネントであり、<span class="bg-code">Square</span>から<span class="bg-code">Board</span>のstateを更新する手段が必要となる。あくまでstateはそれを定義するコンポーネントにプライベートなものであるため、<span class="bg-code">Square</span>から<span class="bg-code">Board</span>のstateは変更することができない。
            <br>代わりとして、<span class="bg-code">Board</span>コンポーネントから<span class="bg-code">Square</span>コンポーネントに関数をわたすことにより、マス目がクリックされた時に<span class="bg-code">Square</span>にその関数を呼び出してもらうようにする。その関数を<span class="bg-code">onSquareClick</span>とする。
            </p>
            <div class="code_container">
                <pre class="prism line-numbers language-js code-content">
<code class="language-js" data-lang="js">function Square({value, onSquareClick}) {
    return (
        &ltbutton className="square" onClick={onSquareClick}&gt
        {value}
        &lt/button&gt
    );
}
</code></pre></div>
            <p>次にBoardコンポーネントにて<span class="bg-code">handleClick</span>として、盤面の情報を更新する関数を定義し、それをSquareコンポーネントに渡す。</p>
            <div class="code_container">
                <pre class="prism line-numbers language-js code-content">
<code class="language-js" data-lang="js">export default function Board() {
    const [squares, setSquares] = useState(Array(9).fill(null));
    function handleClick() {
        const newSquares = squares.slice();
        nextSquares[0] = 'X';
        setSquares(nextSquares);
    }
    return (
        //...
    );
}
</code></pre></div>
            <p><span class="bg-code">handleClick</span>関数は初めに配列のコピーを行い次の配列の準備をする。次に配列の中身をへこうする処理を行いその配列を<span class="bg-code">setSquares</span>に通し、盤面情報を管理する配列を更新する。</p>
            <div class="code_container">
                <pre class="prism line numbers language-js code-content">
<code class="language-js" data-lang="js">export default function Board() {
    const [squares, setSquares] = useState(Array(9).fill(null));
    function handleClick(i) {
        const newSquares = squares.slice();
        newSquares[i] = 'X';
        setSquares(newSquares);
    }
    return (
        //...
    );
}
</code></pre></div>
            <p>次にSquareコンポーネントにてこの関数を呼び出しは次のようにする。</p>
            <div class="code_container">
                <pre class="prism line-numbers language-js code-content">
<code class="language-js" data-lang="js">&ltSquare value={squares[0]} onSquareClick={handleClick(0)} /&gt</code></pre></div>
            <p>しかし、このプログラムでは正しく動作しない。onSquareClickに関数を渡すつもりが、<span class="bg-code">handleClick(0)</span>の実行値を渡す式となってしまっている。これを解決し、ユーザーがクリックしたときに、正しく関数が動くようにするために、<span class="bg-code">handleClick(0)</span>を呼び出すための関数を次のようにつくる。</p>
            <div class="code_container">
                <pre class="prism line-numbers language-js code-content">
<code class="language-js" data-lang="js">&ltSquare value={squares[0]} onSquareClick={() =&gt handleClick(0)} /&gt</code></pre></div>
            <p><span class="bg-code">()=&gt</span>はアロー関数と呼ばれ、関数名を命名しない無名関数の1つ。ここではSquareにアローの無名関数を渡し、その関数を実行することにより実質的に<span class="bg-code">handleClick(i)</span>を実行していることとなる。他のマスも同様にすることで正しく処理ができる。</p>
            <p>ここまでのコード一は次のようになる。</p>
            <div class="code_container">
                <pre class="prism line-numbers language-js code-content">
<code class="language-js" data-lang="js">import { useState } from "react";
function Square({ value, onSquareClick }) {
    return (
        &lt;button className="square" onClick={onSquareClick}&gt;
        {value}
        &lt;/button&gt;
    );
}
    
export default function Board() {
    const [squares, setSquares] = useState(Array(9).fill(null));
    function handleClick(i) {
        const nextSquares = squares.slice();
        nextSquares[i] = "X";
        setSquares(nextSquares);
    }
    return (
        &lt;&gt;
            &lt;div className="board-row"&gt;
                &lt;Square value={squares[0]} onSquareClick={() =&gt; handleClick(0)} /&gt;
                &lt;Square value={squares[1]} onSquareClick={() =&gt; handleClick(1)} /&gt;
                &lt;Square value={squares[2]} onSquareClick={() =&gt; handleClick(2)} /&gt;
            &lt;/div&gt;
            &lt;div className="board-row"&gt;
                &lt;Square value={squares[3]} onSquareClick={() =&gt; handleClick(3)} /&gt;
                &lt;Square value={squares[4]} onSquareClick={() =&gt; handleClick(4)} /&gt;
                &lt;Square value={squares[5]} onSquareClick={() =&gt; handleClick(5)} /&gt;
            &lt;/div&gt;
            &lt;div className="board-row"&gt;
                &lt;Square value={squares[6]} onSquareClick={() =&gt; handleClick(6)} /&gt;
                &lt;Square value={squares[7]} onSquareClick={() =&gt; handleClick(7)} /&gt;
                &lt;Square value={squares[8]} onSquareClick={() =&gt; handleClick(8)} /&gt;
            &lt;/div&gt;
        &lt;/&gt;
    );
}
</code></pre></div>
            <h4>○を表示する</h4>
            <p>今の状態ではXしか入力できないため○の入力の処理を作成する。先手を"X"とし、現在の手番の追跡を行うstateを追加する。</p>
            <div class="code_container">
                <pre class="prism line-numbers language-js code-content">
<code class="language-js" data-lang="js">export default function Board() {
    const [squares, setSquares] = useState(Array(9).fill(null));    // 盤面の状態
    const [xIsNext, setXIsNext] = useState(true);                   // 次の手番が"X"かどうか

    //...
}
</code></pre></div>
            <p><span class="bg-code">xIsNext</span>はプレイヤーが着手するたびに反転するため<span class="bg-code">headClick</span>関数にて処理を行えば良い。</p>
            <div class="code_container">
                <pre class="prism line-numbers language-js code-content">
<code class="language-js" data-lang="js">export default function Board() {
    //...
    function handleClick(i) {
        const nextSquares = squares.slice();
        if (xIsNext) {              // 次の手番が"X"の場合
            nextSquares[i] = "X";   
        } else {                    // 次の手番が"O"の場合
            nextSquares[i] = "O";
        }
        setSquares(nextSquares);    // 盤面の状態を更新
        setXIsNext(!xIsNext);       // 次の手番を更新
    }
    //...
}
</code></pre></div>
            <p>動作結果は次のようになる。クリックするごとに◯とXが入れ替わることが確認できる。</p>
            <img src="../../images/articles/01_react/007.png" alt="">
            <p>ここで1つ問題がある。すでに入力された部分を再度入力することで上書きができてしまう。三目並べという同じパターンになってしまうゲームのためそのようなルールは面白いが今回はそのようなルールは考えないためすでに入力された部分には入力できないようにする必要がある。
            <br>対処として、クリックされた時、そのマスに何かしらの値が入っている場合盤面や手番の更新を行わないことで対応する。
            </p>
            <div class="code_container">
                <pre class="prism line-numbers language-js code-content">
<code class="language-js" data-lang="js">function headClick() {
    if (squares[i]) {
        return;
    }
    const nextSquares = squares.slice();
    //...
}
</code></pre></div>
            <p>ここまでのコードは次のようになる。</p>
            <div class="code_container">
                <pre class="prism line-numbers language-js code-content">
<code class="language-js" data-lang="js">import { useState } from "react";
function Square({ value, onSquareClick }) {
    return (
        &lt;button className="square" onClick={onSquareClick}&gt;
        {value}
        &lt;/button&gt;
    );
}
    
export default function Board() {
    const [squares, setSquares] = useState(Array(9).fill(null));
    const [xIsNext, setXIsNext] = useState(true);
    function handleClick(i) {
        if (squares[i]) {
            // console.log("filled!");
            return;
        }
        const nextSquares = squares.slice();
        if (xIsNext) {  // 次の手番が"X"の場合
            nextSquares[i] = "X";
        } else {        // 次の手番が"O"の場合
            nextSquares[i] = "O";   
        }
        setSquares(nextSquares); // 盤面の状態を更新
        setXIsNext(!xIsNext); // 次の手番を更新
    }
    return (
        &lt;&gt;
            &lt;div className="board-row"&gt;
                &lt;Square value={squares[0]} onSquareClick={() =&gt; handleClick(0)} /&gt;
                &lt;Square value={squares[1]} onSquareClick={() =&gt; handleClick(1)} /&gt;
                &lt;Square value={squares[2]} onSquareClick={() =&gt; handleClick(2)} /&gt;
            &lt;/div&gt;
            &lt;div className="board-row"&gt;
                &lt;Square value={squares[3]} onSquareClick={() =&gt; handleClick(3)} /&gt;
                &lt;Square value={squares[4]} onSquareClick={() =&gt; handleClick(4)} /&gt;
                &lt;Square value={squares[5]} onSquareClick={() =&gt; handleClick(5)} /&gt;
            &lt;/div&gt;
            &lt;div className="board-row"&gt;
                &lt;Square value={squares[6]} onSquareClick={() =&gt; handleClick(6)} /&gt;
                &lt;Square value={squares[7]} onSquareClick={() =&gt; handleClick(7)} /&gt;
                &lt;Square value={squares[8]} onSquareClick={() =&gt; handleClick(8)} /&gt;
            &lt;/div&gt;
        &lt;/&gt;
    );
}
</code></pre></div>
            <h3>終了処理</h3>
            <p>前編のゴールとして終了の処理を実装する。9つのマスの中で縦・横・斜めのいずれかにおいて3連続並べることで勝利を確定することができる。
            <br>勝利判定として8パターンあるので、それぞれのマスの番号を配列として渡し、その値全てが等しい時に勝利とすれば良い。この処理を行う関数を<span class="bg-code">calculateWinner</span>として定義する。
            </p>
            <div class="code_container">
                <pre class="prism line-numbers language-js code-content">
<code class="language-js" data-lang="js">function calculateWinner(squares) {
    const lines = [
        [0, 1, 2], [3, 4, 5], [6, 7, 8], // 横
        [0, 3, 6], [1, 4, 7], [2, 5, 8], // 縦
        [0, 4, 8], [2, 4, 6] // 斜め
    ];
    for (let i = 0; i &lt lines.length; i++) {
        const [a, b, c] = lines[i];
        if (squares[a] && squares[a] === squares[b] && squares[a] === squares[c]) {
            return squares[a];
        }
    }
    return null;
}
</code></pre></div>
            <p>この関数はReact特有ではないためあまり重要視しない。ただし、この判定方法はゲームなどにおいては多く用いる場面が多い。</p>
            <p>この関数の呼び出しは<span class="bg-code">handleClick</span>関数内で読み込み追加入力ができないようにすると同時に勝利宣言をする。</p>
            <div class="code_container">
                <pre class="prism line-numbers language-js code-content">
<code class="language-js" data-lang="js">function handleClick(i) {
    if (squares[i] || calculateWinner(squares)) {
        return;
    }
    const nextSquares = squares.slice();
    //...
}
</code></pre></div>
            <h4>勝利した者のUI表示</h4>
            <p>現在の状態の出力のために新たにdivを用意し、その中にステータス状態を入れることで文字の出力を考える。
            </p>
            <div class="code_container">
                <pre class="prism line-numbers language-js code-content">
<code class="language-js" data-lang="js">export default function Board() {
    //...
    const winner = calculateWinner(squares);
    let status;
    if (winner) {
        status = "Winner: " + winner;
    } else {
        status = "Next player: " + (xIsNext ? "X" : "O");
    }
    return (
        &lt;&gt;
            &lt;div className="status"&gt;{status}&lt;/div&gt;
            &lt;div className="board-row"&gt;
                //...
    )
}
</code></pre></div>
            <p>このように勝利者がいる場合、その勝利者を表示するようにする。このようにすることで勝利者が表示されるようになる。</p>
            <img src="../../images/articles/01_react/008.png" alt="">
            <p>これで今回の目標であるゲーム自体の作成に到達できた。この段階でのプログラムを示す。</p>
            <div class="code_container">
                <pre class="prism line-numbers language-js code-content">
<code class="language-js" data-lang="js">import { useState } from "react";
function Square({ value, onSquareClick }) {
  return (
    &lt;button className="square" onClick={onSquareClick}&gt;
      {value}
    &lt;/button&gt;
  );
}

export default function Board() {
  const [squares, setSquares] = useState(Array(9).fill(null));
  const [xIsNext, setXIsNext] = useState(true);
  function handleClick(i) {
    if (squares[i] || calculateWinner(squares)) {
      console.log("win!");
      return;
    }
    const nextSquares = squares.slice();
    if (xIsNext) {
      // 次の手番が"X"の場合
      nextSquares[i] = "X";
    } else {
      // 次の手番が"O"の場合
      nextSquares[i] = "O";
    }
    setSquares(nextSquares); // 盤面の状態を更新
    setXIsNext(!xIsNext); // 次の手番を更新
  }
  const winner = calculateWinner(squares);
  let status;
  if (winner) {
    status = "Winner: " + winner;
  } else {
    status = "Next player: " + (xIsNext ? "X" : "O");
  }
  return (
    &lt;&gt;
      &lt;div className="status"&gt;{status}&lt;/div&gt;
      &lt;div className="board-row"&gt;
        &lt;Square value={squares[0]} onSquareClick={() =&gt; handleClick(0)} /&gt;
        &lt;Square value={squares[1]} onSquareClick={() =&gt; handleClick(1)} /&gt;
        &lt;Square value={squares[2]} onSquareClick={() =&gt; handleClick(2)} /&gt;
      &lt;/div&gt;
      &lt;div className="board-row"&gt;
        &lt;Square value={squares[3]} onSquareClick={() =&gt; handleClick(3)} /&gt;
        &lt;Square value={squares[4]} onSquareClick={() =&gt; handleClick(4)} /&gt;
        &lt;Square value={squares[5]} onSquareClick={() =&gt; handleClick(5)} /&gt;
      &lt;/div&gt;
      &lt;div className="board-row"&gt;
        &lt;Square value={squares[6]} onSquareClick={() =&gt; handleClick(6)} /&gt;
        &lt;Square value={squares[7]} onSquareClick={() =&gt; handleClick(7)} /&gt;
        &lt;Square value={squares[8]} onSquareClick={() =&gt; handleClick(8)} /&gt;
      &lt;/div&gt;
    &lt;/&gt;
  );
}

function calculateWinner(squares) {
  const lines = [
    [0, 1, 2], [3, 4, 5], [6, 7, 8], // 横
    [0, 3, 6], [1, 4, 7], [2, 5, 8], // 縦
    [0, 4, 8], [2, 4, 6], // 斜め
  ];
  for (let i = 0; i &lt lines.length; i++) {
    const [a, b, c] = lines[i];
    if (squares[a] && squares[a] === squares[b] && squares[a] === squares[c]) {
      return squares[a];
    }
  }
  return null;
}
</code></pre></div>
        </div>
        <div class="large-section">
            <h2>まとめ</h2>
            <p>以前Reactを触ったことがある筆者が全てを理解しながら大体1時間ほどで学ことができた。Reactには今回触れた内容以外にもReactならではの部分があり今後はそれに触れることができれば良いと思う。
            </p>
            <p>React入門において公式チュートリアルはかなり良いものであった。あまりブログなどでチュートリアルが取り上げられておらず学ぶ方法も限られているが広く普及されれば良いなと思っている。</p>
            <p>次回はこの続きである過去に戻る処理を追加したい。また今後実際にフロントエンドでの作業方法なども勉強できれば良い。</p>
            <p>本コンテンツの作成時間（HTML/CSS/JavaScriptの設計・実装を含む）:約16時間</p>
        </div>
    </main>

    <footer>
        <p>© copyright 2023 ai10pro/とりさん. all right resolved.</p>
    </footer>
</body>
</html>